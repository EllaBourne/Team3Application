<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ stock_symbol }} - StockWiz</title>
    <link rel="stylesheet" href="{{ request.url_for('static', path='css/style.css') }}">
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <!-- Toggle button in its own fixed container -->
    <div class="toggle-btn-container">
        <button class="toggle-btn" id="toggleModeBtn" title="Toggle light/dark mode">
            <span id="toggleIcon">üåô</span>
        </button>
    </div>
    <header class="main-header">
        <div class="header-content">
            <div class="header-title">
                <span class="logo-dot"></span>
                <span class="logo-text">{{ stock_symbol }} Stock Chart</span>
            </div>
        </div>
    </header>
    <p class="header-desc">10-Year Historical Price (USD)</p>
    <div class="container" style="text-align:center;">
        <div id="stock-chart" style="margin:0 auto; width:90vw; max-width:1100px; min-width:320px; height:420px;"></div>
        <div style="margin-top:24px; display:flex; justify-content:center; gap:16px; flex-wrap:wrap;">
            <form action="{{ request.url_for('home') }}" method="get" style="display:inline;">
                <button type="submit" class="home-btn">‚¨ÖÔ∏è Back to Search</button>
            </form>
            <form method="post" action="{{ request.url_for('report') }}" style="display:inline;">
                <input type="hidden" name="stock_symbol" value="{{ stock_symbol }}">
                <button type="submit" class="home-btn danger">View Full Report</button>
            </form>
        </div>
        {% if news_articles %}
        <div class="card" style="margin-top:40px; text-align:left;">
            {% if nl_summary %}
            <div class="nl-summary" style="margin-bottom:12px; color:var(--primary); font-size:1.08em;">
                <em>{{ nl_summary }}</em>
            </div>
            {% endif %}
            <h2 class="section-title">Latest News</h2>
            <ul style="list-style:none; padding:0;">
                {% for article in news_articles %}
                <li style="margin-bottom:18px;">
                    <a href="{{ article.url }}" target="_blank" style="font-weight:600; color:var(--accent); text-decoration:none;">
                        {{ article.title }}
                    </a>
                    <br>
                    <span style="font-size:0.95em; color:#888;">{{ article.source.name }} | {{ article.publishedAt[:10] }}</span>
                    <p style="margin:6px 0 0 0; color:inherit;">{{ article.description }}</p>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </div>
    <footer>
        2025 StockWiz &mdash; Powered by Yahoo Finance
    </footer>
    <script>
    // Light/Dark mode toggle
    const toggleBtn = document.getElementById('toggleModeBtn');
    const toggleIcon = document.getElementById('toggleIcon');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    function setMode(dark) {
        if (dark) {
            document.body.classList.add('dark-mode');
            toggleIcon.textContent = '‚òÄÔ∏è';
        } else {
            document.body.classList.remove('dark-mode');
            toggleIcon.textContent = 'üåô';
        }
        sessionStorage.setItem('darkMode', dark ? '1' : '0');
    }
    function getChartOptions() {
        const dark = document.body.classList.contains('dark-mode');
        return {
            chart: {
                type: 'line',
                backgroundColor: 'transparent'
            },
            title: {
                text: 'Historical Stock Prices for {{ stock_symbol }} (10 Years)',
                style: { color: dark ? '#b3baff' : 'var(--primary)' }
            },
            xAxis: {
                type: 'datetime',
                title: { text: 'Date', style: { color: dark ? '#b3baff' : 'inherit' } },
                labels: { style: { color: dark ? '#b3baff' : 'inherit' } },
                gridLineColor: dark ? '#353945' : '#e6e8ec'
            },
            yAxis: {
                title: { text: 'Price (USD)', style: { color: dark ? '#b3baff' : 'inherit' } },
                labels: { style: { color: dark ? '#b3baff' : 'inherit' } },
                gridLineColor: dark ? '#353945' : '#e6e8ec'
            },
            series: [{
                name: "{{ stock_symbol }}",
                data: {{ chart_data|tojson|safe }},
                color: dark ? "#b3baff" : "#0033a0",
                lineWidth: 3,
                marker: { enabled: false }
            }],
            credits: { enabled: false }
        };
    }
    function renderChart() {
        Highcharts.stockChart('stock-chart', getChartOptions());
    }
    toggleBtn.onclick = () => {
        setMode(!document.body.classList.contains('dark-mode'));
        setTimeout(renderChart, 200);
    };
    setMode(sessionStorage.getItem('darkMode') === '1' || (sessionStorage.getItem('darkMode') === null && prefersDark));
    document.addEventListener('DOMContentLoaded', renderChart);
    </script>
</body>
</html>